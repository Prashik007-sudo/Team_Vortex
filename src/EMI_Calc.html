<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EMI Calculator</title>
    <style>
        /* General Body and Main Layout Styling */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f0f4f8, #e4e7eb);
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align items to the start of the cross axis */
            min-height: 100vh;
            color: #333;
            gap: 30px; /* Space between calculator and chart */
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        .main-content {
            display: flex;
            gap: 30px;
            flex-wrap: nowrap; /* Allow wrapping for responsiveness */
            justify-content: center; /* Center items when they wrap */
            align-items: center;
        }

        .container {
            max-width: 450px;
            width: 100%;
            background: #ffffff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid #ddd;
        }

        /* Heading and Label Styling */
        h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 24px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        /* Sliders and Labels */
        .slider-group {
            margin-bottom: 20px;
        }
        
        .slider-group label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }

        input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            background: #e0e0e0;
            border-radius: 5px;
            height: 8px;
            outline: none;
            transition: background 0.3s;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3498db;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3498db;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Result Section Styling */
        .result {
            margin-top: 25px;
            padding: 20px;
            background: #eaf6ff;
            border-radius: 10px;
            border: 1px solid #b3e0ff;
            line-height: 1.6;
            text-align: center;
        }

        .result b {
            color: #2c3e50;
        }

        /* Chart Container Styling */
        .chart-container {
            background: #ffffff;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid #ddd;
            max-width: 450px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: normal;
            justify-content: center;
        }

        #emiChart {
            max-width: 80%;
            height: auto;
        }

        .chart-legend {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            font-size: 14px;
            align-items: flex-start;
            width: 100%;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="main-content">
        <div class="container">
            <h2>EMI Calculator</h2>

            <div class="slider-group">
                <label for="loan">
                    Loan Amount (₹)
                    <span id="loanValue">500000</span>
                </label>
                <input type="range" id="loan" min="100000" max="10000000" step="50000" value="500000">
            </div>

            <div class="slider-group">
                <label for="rate">
                    Annual Interest Rate (%)
                    <span id="rateValue">8.5</span>
                </label>
                <input type="range" id="rate" min="1" max="25" step="0.1" value="8.5">
            </div>

            <div class="slider-group">
                <label for="years">
                    Tenure (years)
                    <span id="yearsValue">10</span>
                </label>
                <input type="range" id="years" min="1" max="30" step="1" value="10">
            </div>

            <div class="result" id="result"></div>
        </div>

        <div class="chart-container">
            <h2>Loan Breakdown</h2>
            <canvas id="emiChart" width="300" height="300"></canvas>
            <div class="chart-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #3498db;"></div>
                    <span>Principal Amount</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e74c3c;"></div>
                    <span>Total Interest</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Get the slider elements and their corresponding value displays
        const loanSlider = document.getElementById('loan');
        const rateSlider = document.getElementById('rate');
        const yearsSlider = document.getElementById('years');
        const loanValue = document.getElementById('loanValue');
        const rateValue = document.getElementById('rateValue');
        const yearsValue = document.getElementById('yearsValue');
        const resultDiv = document.getElementById('result');

        // Chart setup
        const emiChartCanvas = document.getElementById('emiChart');
        const ctx = emiChartCanvas.getContext('2d');
        const chartColors = ['#3498db', '#e74c3c']; // Blue for Principal, Red for Interest

        function drawPieChart(principal, interest) {
            let total = principal + interest;
            let principalAngle = (principal / total) * 2 * Math.PI;
            let interestAngle = (interest / total) * 2 * Math.PI;

            // Clear the canvas
            ctx.clearRect(0, 0, emiChartCanvas.width, emiChartCanvas.height);

            const centerX = emiChartCanvas.width / 2;
            const centerY = emiChartCanvas.height / 2;
            const radius = Math.min(centerX, centerY) - 20; // Give some padding

            let startAngle = 0;

            // Draw Principal slice
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.arc(centerX, centerY, radius, startAngle, startAngle + principalAngle);
            ctx.closePath();
            ctx.fillStyle = chartColors[0];
            ctx.fill();
            startAngle += principalAngle;

            // Draw Interest slice
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.arc(centerX, centerY, radius, startAngle, startAngle + interestAngle);
            ctx.closePath();
            ctx.fillStyle = chartColors[1];
            ctx.fill();

            // Optional: Add labels inside the slices if space allows
            if (principal > 0) {
                const principalMidAngle = principalAngle / 2;
                const textX = centerX + Math.cos(principalMidAngle) * (radius / 2);
                const textY = centerY + Math.sin(principalMidAngle) * (radius / 2);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                if (principalAngle > 0.5) { // Only draw if slice is big enough
                   // ctx.fillText(`${((principal / total) * 100).toFixed(1)}%`, textX, textY);
                }
            }
            if (interest > 0) {
                const interestMidAngle = startAngle + interestAngle / 2;
                const textX = centerX + Math.cos(interestMidAngle) * (radius / 2);
                const textY = centerY + Math.sin(interestMidAngle) * (radius / 2);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                if (interestAngle > 0.5) { // Only draw if slice is big enough
                  //  ctx.fillText(`${((interest / total) * 100).toFixed(1)}%`, textX, textY);
                }
            }
        }


        function calculateEMI() {
            let P = parseFloat(loanSlider.value);
            let annualRate = parseFloat(rateSlider.value);
            let N_years = parseInt(yearsSlider.value);
            let N = N_years * 12; // Convert years to months

            // Default values for chart if inputs are invalid or zero
            let principalForChart = P;
            let totalInterestForChart = 0;
            let emiText = "";

            // Check for valid inputs
            if (isNaN(P) || isNaN(annualRate) || isNaN(N) || P <= 0 || annualRate < 0 || N <= 0) {
                emiText = "Please enter valid numbers for all fields.";
                // Clear chart or show an initial state
                drawPieChart(1, 0); // Show principal only if invalid input
            } else {
                let R = annualRate / 12 / 100;

                // Handle zero interest rate case
                if (R === 0) {
                    emiText = "<b>Monthly EMI:</b> ₹" + (P / N).toFixed(2) + "<br>" +
                              "<b>Total Interest:</b> ₹0.00<br>" +
                              "<b>Total Payment:</b> ₹" + P.toFixed(2);
                    principalForChart = P;
                    totalInterestForChart = 0;
                } else {
                    let EMI = (P * R * Math.pow(1 + R, N)) / (Math.pow(1 + R, N) - 1);
                    let totalPayment = EMI * N;
                    let totalInterest = totalPayment - P;

                    emiText = `
                        <b>Monthly EMI:</b> ₹${EMI.toFixed(2)}<br>
                        <b>Total Interest:</b> ₹${totalInterest.toFixed(2)}<br>
                        <b>Total Payment:</b> ₹${totalPayment.toFixed(2)}
                    `;
                    principalForChart = P;
                    totalInterestForChart = totalInterest;
                }
            }
            
            resultDiv.innerHTML = emiText;
            drawPieChart(principalForChart, totalInterestForChart);
        }

        // Add event listeners to each slider to trigger calculations and value updates
        loanSlider.addEventListener('input', () => {
            loanValue.textContent = parseInt(loanSlider.value).toLocaleString('en-IN'); // Format with commas
            calculateEMI();
        });

        rateSlider.addEventListener('input', () => {
            rateValue.textContent = rateSlider.value;
            calculateEMI();
        });

        yearsSlider.addEventListener('input', () => {
            yearsValue.textContent = yearsSlider.value;
            calculateEMI();
        });

        // Run calculation once on page load to show initial result and chart
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial formatted values
            loanValue.textContent = parseInt(loanSlider.value).toLocaleString('en-IN');
            rateValue.textContent = rateSlider.value;
            yearsValue.textContent = yearsSlider.value;
            calculateEMI();
        });
    </script>
</body>
</html>